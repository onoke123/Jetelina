<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
        <link rel="stylesheet" href="jetelina/css/dashboard.css">

        <script type="text/javascript" src="js/genie/jquery.min.js"></script>
        <script type="text/javascript" src="js/jquery-ui-1.13.2/jquery-ui.min.js"></script>
        
        <script type="text/javascript" src="jetelina/js/fileupload.js"></script>
        <script type="text/javascript" src="jetelina/js/databinde.js"></script>
        <!--
        <script type="text/javascript" src="jetelina/js/csvdatashow.js"></script>
        -->
        <script type="text/javascript" src="jetelina/js/draganddropitems.js"></script>
    </head>
    <body>
        <form id="my_form">
            <!-- caution:
                should change the parameter of 'name' in FileUploadController.jl
                if it's changed to other. 
            -->
            <input type="file" name="upfile">
            <button type="button" id="upbtn">up</button>
        </form>

        <text>here you are</text>
        <!--div id="d_data"/-->
        <div id="d_tablelist"></div>

        <!-- drag & drop data area -->
        <div id="container">
            <div class="item_area">
            </div>
          
            <div class="drop_area">
              <p>hear the drop area</p>
            </div>
          </div>
          
          <div>
              <button id="post">POST</button>
          </div>
          
    </body>
    <script>
        $(function(){
            /*
            引数に渡されたオブジェクトを分解取得する。
            */
            const getdata = ( o ) => {
                if( o != null ){
                    Object.keys( o ).forEach( function( key ) {
                        //’Jetelina’をシンボルにしているからこうしている
                        if( key == "Jetelina" && o[key].length > 0 ){
                            $.each( o[key], function(k,v){
                                if( v != null ){
                                    /* オブジェクトを配列にしているのでここまでやって
                                    　　初めてname/valueのデータが取得できる。
                                    */
                                    let str = "";
                                    $.each( v, function( name, value ){
                                        str += `${name}:${value}`;

                                    });

                                    // d_tablelistにデータをバインドする
                                    $( "#d_tablelist" ).append( `${str}<br>` );
                                }
                            })
                        }

                    });
                }
            }

            // 画面起動時にDBのtableリストを取得する
            const getAjaxData = () => {
                $.ajax( {
                    url: "/getalldbtable",
                    type: "GET",
                    data: "",
                    dataType: "json",
                }).done(function(result, textStatus, jqXHR) {
                    // data parseに行く
                    getdata( result );
                }).fail( function( result ){
                });
            }

            getAjaxData();

            //選択されたtableのcolumnリストを取得する

        });
    </script>
</html>