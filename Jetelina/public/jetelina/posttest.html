<html>
    <head>
        <script type="text/javascript" src="../js/genie/jquery.min.js"></script>
        <link rel="stylesheet" href="css/dashboard.css">
        <link type="text/css" rel="stylesheet" href="css/tablelist.css">
    </head>
    <body>
        <button onclick="getAjaxData('s')">very simple Select</button>
        <br>
        <button onclick="getAjaxData('w')">complecate Select</button>
        <br>
        <button onclick="getAjaxData('i')">data insert</button>
        <br>
        <button onclick="getAjaxData('u')">update</button>
        <br>
        <button onclick="getAjaxData('d')">delete</button>
        <br>
        <button onclick="changeParam()">Change Configuration Parameter test</button>
        <br>
        <button onclick="sqlPreExecTest()">SQL pre execution test</button>
        <br>
        <!--
        <button onclick="getAjaxData('u')">Update</button>
        <br>
        <button onclick="getAjaxData('i')">Insert</button>
        <br>
        <button onclick="getAjaxData('d')">Delete</button>
        -->
        <div id="apitest">
			<div name="api-test-msg">
			</div>
			<div name="api-test-data">
			</div>
		</div>

        <div>
            <text>Message From Jetelina</text>
            <text id="mfj"></text>
        </div>
        <div id="result" class="functionpanel-parts commonpanel squarepanel" style="color: aliceblue;">
        </div>
    </body>
</html>
<script type="text/javascript">
    let insertcountnumber = 5;
//    const sample = {"date":"2024-03-18 11:28:40","name":"changed user name","previous":{"debug":"true","logfile":"log.txt"},"latest":{"debug":"false","logfile":"log1.txt"}};
    const sample = {"date":"2024-03-18 11:28:40","name":"changed user name","previous":{},"latest":{"debug":"false","logfile":"log1.txt"}};
//    console.log(typeof(sample));
    Object.keys(sample).forEach(function(key){
//        console.log("key is ", key);
        if( key == "previous"){
            $.each(sample[key],function(k,v){
//                console.log(sample[key], " -> key=value ", k,v);
            });
        }
    });

    const changeParam = () =>{
        let pd = {};
//        pd["configparam"] = "debug=true,logfile=log.txt";
//        let dd = JSON.stringify(pd);
        let dd = "{\"debug\":\"false\",\"logfile\":\"log1.txt\"}";
        $.ajax( {
            url: "/changeconfigdata",
            type: "post",
            data: dd,
            contentType: 'application/json',
            dataType: "json",
        }).done(function(result, textStatus, jqXHR) {
        }).fail( function( result ){
        }).always(function(result){
        });
    }

    const sqlPreExecTest = () => {
        const aa = "aa";
        let pd = {};
        pd["item"] = ["org1000.jt_id","org1000.name"];
        pd["subquery"] = "where 2020<org1000.founded"; 
        pd["mode"] = "pre";
        let dd = JSON.stringify(pd);
//        console.log("dd is ", dd);
//        console.log("aa is ", aa);
        $.ajax( {
            url: "/createapi",
            type: "post",
            data: dd,
            contentType: 'application/json',
            dataType: "json",
        }).done(function(result, textStatus, jqXHR) {
//            console.log("data count: ", result.Jetelina.length);
//            console.log("data strig ", JSON.stringify(result.Jetelina));
//            console.log("message : ", result["message from Jetelina"]);
            let datanumber = result.Jetelina.length;
            let jetelinamessage = result["message from Jetelina"];
            let testmsg =`<span class="apisql"><p>Conguraturation, well done.<br>aquaiable data number is ${datanumber}</p></span>`
            $("#apitest [name='api-test-msg']").append(testmsg);
            let testdata = JSON.stringify(result.Jetelina);
            $("#apitest [name='api-test-data'").append(`<span class=\"apisql\"><p>${testdata}</p></span>`);

        }).fail( function( result ){
        }).always(function(result){
        });
    }

    const getAjaxData = (s) => {
        let pd = {};
        if(s=="s"){
            pd["apino"] = "js327";
        }else if(s=="w"){
//            pd["apino"] = "js333";
//            pd["subquery"] = "['ftest_ave':0.4,'ftest_age':20]";
            pd["apino"] = "js789";
            pd["subquery"] = "['sex':'m']";
        }else if(s=="u"){
            // mysql/postgresql
            /*
            pd["apino"] = "ju787";
            pd["ftest_name"] = "AAA10";
            pd["ftest_sex"] = "f";
            pd["ftest_age"] = 30;
            pd["ftest_ave"] = 0.9;
            pd["subquery"] = 1;
            */
           //redis
           pd["apino"] = "ju832";
           pd["key"] = "AAAB";
        }else if(s=="i"){
            // mysql/postgresql
            /*
            pd["apino"] = "ji822";
            pd["ftest_name"] = "ZZZ";
            pd["ftest_sex"] = "m";
            pd["ftest_age"] = 60;
            pd["ftest_ave"] = 0.5;
            */
            //redis
            pd["apino"] = "ji825";
            pd["key1"] = "A1";
            pd["key2"] = "aaa1";
        }else if(s=="d"){
            pd["apino"] = "jd821";
            pd["subquery"] = 5;
        }

        let dd = JSON.stringify(pd);
        console.log("dd is ", dd);

        let url = "http://127.0.0.1:8000/apiactions"
        $.ajax( {
            url: url,
            type: "post",
            data: dd,
            contentType: 'application/json',
            dataType: "json",
        }).done(function(result, textStatus, jqXHR) {
            $(".re").remove();

            if( -1<$.inArray(s,['s','w'])){
                Object.keys(result).forEach(function (key) {
                if(key=="Jetelina"){
                    $.each(result[key],function (k, v) {
//                        console.log(k,":",v);
                        vv = JSON.stringify(v);
                            $("#result").append(`<p class="">${vv}</p>`);
                    });
                }
                /*
                if( key=="message from Jetelina" ){
                    $("#mfj").text(result[key])
                }*/
            });

            }else if(-1<$.inArray(s,['i','u','d'])){
                let msg = result["message from Jetelina"]
                $("#result").append(`<p class="">${msg}</p>`);
            }
        }).fail( function( result ){
        }).always(function(result){
        });
    }
</script>
