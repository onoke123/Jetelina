<html>

<head>
    <script type="text/javascript" src="../js/genie/jquery.min.js"></script>
    <link rel="stylesheet" href="css/dashboard.css">
    <link type="text/css" rel="stylesheet" href="css/tablelist.css">

    <link rel="icon" href="img/jetelina.ico">
    <title>Jetelina WebApis test page</title>
</head>

<body>
    <h3 style="color: aliceblue;">This is the test page for Jetelina WebApis</h3>
    <div style="color: aliceblue;">
        Set your api name, e.g js100, in the 'Api Name' field, then put the parameters 'Key' and 'Value' name due to the
        interface.<br>
        This page send these params to Jetelina in JSON form.<br>
        The result is shown in the 'Result' filed.<br>
        Feel free to try 'select' and 'update' apis, but take care in 'insert' and 'delete' apis.
    </div>
    <div name="params" style="color: aliceblue;">
        <p name="apiname">Api Name<input type="text" name="apiname" size="10"></p>
        <p name="p1">1: Key Name<input type="text" name="k" size="10"> Value Name<input type="text" name="v" size="10">
        </p>
        <p name="p2">2: Key Name<input type="text" name="k" size="10"> Value Name<input type="text" name="v" size="10">
        </p>
        <p name="p3">3: Key Name<input type="text" name="k" size="10"> Value Name<input type="text" name="v" size="10">
        </p>
        <p name="p4">4: Key Name<input type="text" name="k" size="10"> Value Name<input type="text" name="v" size="10">
        </p>
        <p name="p5">5: Key Name<input type="text" name="k" size="10"> Value Name<input type="text" name="v" size="10">
        </p>
    </div>
    <a href="#" onclick="morePara()" style="font-size: smaller;">more parameter field</a>
    <p></p>
    <p></p>
    <div>
        <button onclick="getAjaxData()">GO Test</button>
    </div>
    <div id="apitest">
        <div name="api-test-msg">
        </div>
        <div name="api-test-data">
        </div>
    </div>

    <div>
        <text>Message From Jetelina</text>
        <text id="mfj"></text>
    </div>
    <div id="result" class="functionpanel-parts commonpanel squarepanel" style="color: aliceblue;">
        <text>Result:</text>
    </div>
</body>

</html>
<script type="text/javascript">
    let paranum = 5;
    const morePara = () => {
        paranum += 1;
        let str = `<p name="p${paranum}">${paranum}: Key Name<input type="text" name="k" size="10"> Value Name<input type="text" name="v" size="10"></p>`;
        $(`p[name='p${paranum - 1}']`).after(str);
    }

    const getAjaxData = () => {
        let apinumber = $("div p[name='apiname'] input[name='apiname']").val();
        if (apinumber == "") {
            let msg = "No Api Name";
            $("#result").append(`<p class="">${msg}</p>`);
            return;
        }else{
            $("#result p").remove();
        }

        let key = [];
        let value = [];
        for (let ii = 0, i = 1; i <= paranum; i++) {
            let k = $(`div p[name='p${i}'] input[name='k']`).val();
            let v = $(`div p[name='p${i}'] input[name='v']`).val();
            if (k != "" && v != "") {
                console.log(k, "->", v);
                key[ii] = k;
                value[ii++] = v;
            }
        }

        let jstr = `{"apino":"${apinumber}",`;
        for (i in key) {
            jstr += `"${key[i]}":"${value[i]}",`;
        }

        jstr = jstr.slice(0, -1) + "}";

        $.ajax({
            url: "/apiactions",
            type: "post",
            data: jstr,
            contentType: 'application/json',
            dataType: "json"
        }).done(function (result, textStatus, jqXHR) {
            $(".re").remove();
            let s = apinumber.slice(0, 2);
            if (-1 < $.inArray(s, ['js'])) {
                Object.keys(result).forEach(function (key) {
                    if (key == "Jetelina") {
                        $.each(result[key], function (k, v) {
                            vv = JSON.stringify(v);
                            $("#result").append(`<p class="">${vv}</p>`);
                        });
                    }
                });

            } else if (-1 < $.inArray(s, ['ji', 'ju', 'jd'])) {
                let msg = result["message from Jetelina"]
                $("#result").append(`<p class="">${msg}</p>`);
            }
        }).fail(function (result) {
        }).always(function (result) {
        });
    }
</script>